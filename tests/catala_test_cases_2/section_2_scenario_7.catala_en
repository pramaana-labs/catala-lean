> Module Section_2_scenario_7
> Using Sections as IRC

```catala
#[test]
declaration scope Section_2_scenario_7:
  output head_of_household_status content IRC.IndividualTaxReturnSection2bHeadOfHouseholdOutput

scope Section_2_scenario_7:
  # Scenario: Head of household disallowed because qualifying child is married at close
  # and filed a joint return not only to claim a refund; taxpayer otherwise meets
  # maintenance and abode requirements and is not married at close.
  # Tested law refs: §2(b)(1)(A)(i)(I)-(II)

  definition head_of_household_status equals
    # Entities
    let t7 equals IRC.Individual { -- id: 1 -- is_counterfactual: false } in
    let c7 equals IRC.Individual { -- id: 2 -- is_counterfactual: false } in
    let c7sp equals IRC.Individual { -- id: 3 -- is_counterfactual: false } in

    let h7 equals IRC.Household { -- id: 1 -- is_counterfactual: false } in

    # Events
    let marriage_c7 equals IRC.MarriageEvent {
      -- id: 1
      -- spouse1: c7
      -- spouse2: c7sp
      -- marriage_date: Date.of_year_month_day of 2025, 5, 1
      -- is_counterfactual: false
    } in

    let res_c7 equals IRC.ResidencePeriodEvent {
      -- id: 1
      -- individual: c7
      -- household: h7
      -- start_date: Date.of_year_month_day of 2025, 1, 1
      -- end_date: Date.of_year_month_day of 2025, 10, 1
      -- is_member_of_household: true
      -- is_principal_place_of_abode: true
      -- is_counterfactual: false
    } in

    let hmc_t7 equals IRC.HouseholdMaintenanceEvent {
      -- id: 1
      -- individual: t7
      -- household: h7
      -- start_date: Date.of_year_month_day of 2025, 1, 1
      -- end_date: Date.of_year_month_day of 2025, 12, 31
      -- cost_furnished_percentage: 0.65
      -- is_counterfactual: false
    } in

    let parent_t7_c7 equals IRC.ParenthoodEvent {
      -- id: 1
      -- parent: t7
      -- child: c7
      -- start_date: Date.of_year_month_day of 2011, 1, 1
      -- parent_type: IRC.ParentType.Biological
      -- is_counterfactual: false
    } in

    let residency_t7 equals IRC.NonresidentAlienStatusPeriodEvent {
      -- id: 1
      -- individual: t7
      -- start_date: Date.of_year_month_day of 2025, 1, 1
      -- end_date: Date.of_year_month_day of 2025, 12, 31
      -- residency_status: IRC.ResidencyStatus.Resident
      -- is_counterfactual: false
    } in

    let tax_return_c7 equals IRC.TaxReturnEvent {
      -- id: 1
      -- individual: c7
      -- tax_year: 2025
      -- filed_joint_return: true
      -- is_only_for_refund_claim: false
      -- qualifying_children: []
      -- dependents: []
      -- is_counterfactual: false
    } in

    # Tax return: Head of Household filing with qualifying person = c7
    let hoh_variant equals IRC.HeadOfHouseholdVariant {
      -- taxpayer: t7
      -- qualifying_person: c7
      -- itemization_election: false
      -- is_estate_or_trust: false
      -- is_common_trust_fund: false
      -- is_partnership: false
    } in
    let individual_tax_return equals IRC.IndividualTaxReturn {
      -- id: 1
      -- tax_year: 2025
      -- details: IRC.FilingStatusVariant.HeadOfHousehold content hoh_variant
    } in

    # Temporary dependent status outputs (assumptions for §151/§152 scopes)
    # Assumption: child is otherwise a qualifying child under §152(c), but is
    # excepted as a dependent under §152(b)(2) due to a joint return not solely for refund.
    let c7_status equals IRC.IndividualDependentStatus {
      -- individual: c7
      -- is_qualifying_child: true
      -- is_qualifying_relative: false
      -- is_excepted_under_152_b_2: true
      -- is_ineligible_under_152_b_1: false
    } in

    let taxpayer_dependents_result equals IRC.IndividualSection152DependentsOutput {
      -- taxpayer: t7
      -- dependents_initial: []
      -- dependents_after_152b1: []
      -- dependents_after_152b2: []
      -- qualifying_children: []
      -- qualifying_relatives: []
      -- individual_dependent_statuses: [ c7_status ]
    } in

    let taxpayer_151_list equals IRC.IndividualSection151ExemptionsListOutput {
      -- individual: t7
      -- spouse_exemption_allowed_151_b: false
      -- individuals_entitled_to_exemptions_under_151: [ t7 ]
    } in
    let taxpayer_exemptions_list_result equals IRC.TaxpayerExemptionsList151Output {
      -- taxpayer_result: taxpayer_151_list
      -- spouse_result: Absent
      -- individuals_entitled_to_exemptions_under_151: [ t7 ]
      -- spouse_exemption_allowed_151_b: false
    } in

    # Compute §2(b) Head of Household status using section-specific scope,
    # passing context variables to reflect the scenario's legal conditions.
    (output of IRC.IndividualTaxReturnSection2bHeadOfHousehold with {
      -- individual_tax_return: individual_tax_return
      -- nonresident_alien_status_period_events: [ residency_t7 ]
      -- parenthood_events: [ parent_t7_c7 ]
      -- household_maintenance_events: [ hmc_t7 ]
      -- residence_period_events: [ res_c7 ]
      -- marriage_events: [ marriage_c7 ]
      -- divorce_or_legal_separation_events: []
      -- family_relationship_events: []
      -- birth_events: []
      -- tax_return_events: [ tax_return_c7 ]
      -- taxpayer_exemptions_list_result: taxpayer_exemptions_list_result
      -- taxpayer_dependents_result: taxpayer_dependents_result
      -- death_events: []
      -- is_surviving_spouse_2_a: false

      # Context variables per §2(b)(1)(A)(i)(I)-(II) and related determinations:
      # Taxpayer determinations under §2(b)(2)
      -- is_legally_separated_2_b_2_A: false
      -- spouse_is_nonresident_alien_2_b_2_B: false
      -- spouse_died_during_year_2_b_2_C: false
      -- is_married_at_year_end_2_b_2: false  # taxpayer not married at close

      # §2(b)(3) limitations
      -- taxpayer_is_nonresident_alien_2_b_3_A: false
      -- head_of_household_disqualified_household_member_dependent_2_b_3_B: false

      # Core tested conditions for qualifying child under §2(b)(1)(A)(i):
      -- qualifying_child_meets_2_b_1_A_i: true  # assumes QC status under §152(c)
      -- is_married_at_year_end_2_b_1_A_i_I: true  # child married at close (I)
      -- is_not_dependent_by_152b2_2_b_1_A_i_II: true  # joint return not only for refund (II)

      # Maintenance and abode under §2(b)(1)(A)
      -- maintains_household_principal_place_of_abode_more_than_half_year_2_b_1_A: true
      -- other_dependent_2_b_1_A_ii: false
      -- maintains_household_for_father_or_mother_2_b_1_B: false

      # Overall status under §2(b)
      -- is_head_of_household_2_b: false
    }).main_output

  # Assertions:
  # Tests §2(b)(1)(A)(i)(I): qualifying child is married at the close of the taxpayer's taxable year
  assertion (head_of_household_status.is_married_at_year_end_2_b_1_A_i_I = true)

  # Tests §2(b)(1)(A)(i)(II): qualifying child filed a joint return not solely to claim a refund,
  # hence not a dependent by reason of §152(b)(2)
  assertion (head_of_household_status.is_not_dependent_by_152b2_2_b_1_A_i_II = true)

  # Tests §2(b)(1): overall head of household status is not satisfied under these conditions
  assertion (head_of_household_status.is_head_of_household_2_b = false)
```