> Module Section_68_scenario_1
> Using Sections as IRC

```catala
#[test]
declaration scope Section_68_scenario_1:
  output itemized_deductions_result content IRC.IndividualTaxReturnSection68ItemizedDeductionsOutput

scope Section_68_scenario_1:
  # Scenario: §68 limitation in tax year 2017 on a joint return with AGI exceeding the applicable amount.
  # Tested law refs: §68(a), §68(b)(1)(A), §68(f)
  # Assumption: Adjusted gross income equals earned income for the taxpayer (per scenario comments).
  # Note: Itemized deductions amount is set to $10,000 solely to exercise the reduction trigger.

  definition itemized_deductions_result equals
    # Entities
    let i1 equals IRC.Individual { -- id: 1 -- is_counterfactual: false } in
    let i2 equals IRC.Individual { -- id: 2 -- is_counterfactual: false } in

    # Individual tax return: Joint return for 2017 per §68(b)(1)(A)
    let joint_return_details equals IRC.JointReturnVariant {
      -- taxpayer: i1
      -- spouse: i2
      -- itemization_election: true
      -- is_estate_or_trust: false
      -- is_common_trust_fund: false
      -- is_partnership: false
    } in
    let individual_tax_return equals IRC.IndividualTaxReturn {
      -- id: 1
      -- tax_year: 2017
      -- details: IRC.FilingStatusVariant.JointReturn content joint_return_details
    } in

    # Temporary marital status output (dependency of §68 scope); married under §7703 for joint return
    let determination_date equals Date.of_year_month_day of 2017, 12, 31 in
    let taxpayer_marital_status equals
      IRC.IndividualSection7703MaritalStatusOutput {
        -- individual: i1
        -- tax_year: 2017
        -- determination_date_7703_a_1: determination_date
        -- is_married_7703_a_1: true
        -- is_legally_separated_7703_a_2: false
        -- maintains_household_7703_b_1: false
        -- furnishes_over_one_half_cost_7703_b_2: false
        -- spouse_not_member_last_6_months_7703_b_3: false
        -- considered_not_married_7703_b: false
        -- is_married_for_tax_purposes_7703: true
      } in

    # Inputs per scenario:
    # AGI assumed equal to earned income of i1 (IncomeEvent shows $400,000 in 2017)
    let adjusted_gross_income equals $400000 in
    # Itemized deductions set to a positive amount to exercise the reduction trigger
    let itemized_deductions equals $10000 in

    # Context values for §68 outputs based on law:
    # §68(b)(1)(A): applicable amount = $300,000 for joint returns (and surviving spouse)
    let applicable_amount equals $300000 in
    # §68(f): section applies in 2017 (non-application window is 2018–2025)
    let section_not_applicable equals false in
    # §68(a)(1): 3% of excess AGI over applicable amount; excess = $400,000 - $300,000 = $100,000 → 3% = $3,000
    let three_percent_reduction equals $3000 in
    # §68(a)(2): 80% of itemized deductions; 80% of $10,000 = $8,000
    let eighty_percent_reduction equals $8000 in
    # §68(a): reduction is the lesser of (3% excess, 80% of itemized deductions) → $3,000
    let reduction_amount equals $3000 in
    # Itemized deductions after reduction: $10,000 - $3,000 = $7,000
    let itemized_after_reduction equals $7000 in

    (output of IRC.IndividualTaxReturnSection68ItemizedDeductions with {
      -- individual_tax_return: individual_tax_return
      -- adjusted_gross_income: adjusted_gross_income
      -- itemized_deductions: itemized_deductions
      -- taxpayer_marital_status: taxpayer_marital_status
      -- is_surviving_spouse: false
      -- is_head_of_household: false

      # Pass §68 outputs via context (assumptions derived from the scenario and legal text)
      -- applicable_amount_68_b_1: applicable_amount                 # Tests §68(b)(1)(A)
      -- section_not_applicable_68_f: section_not_applicable         # Tests §68(f)
      -- three_percent_reduction_68_a_1: three_percent_reduction     # Tests §68(a)(1)
      -- eighty_percent_reduction_68_a_2: eighty_percent_reduction   # Tests §68(a)(2)
      -- reduction_amount_68_a: reduction_amount                     # Lesser-of rule in §68(a)
      -- itemized_deductions_after_68: itemized_after_reduction
    }).main_output

  # Assertions:
  # applicable_amount_under_68_b_1 = $300,000 per §68(b)(1)(A) for joint returns
  assertion (itemized_deductions_result.applicable_amount_68_b_1 = $300000)

  # section_68_applies_for_tax_year: true → assert §68(f) non-application flag is false in 2017
  assertion (itemized_deductions_result.section_not_applicable_68_f = false)

  # agi_exceeds_applicable_amount: true → evidenced by a positive 3% reduction under §68(a)(1)
  assertion (itemized_deductions_result.three_percent_reduction_68_a_1 > $0)

  # agi_excess_amount = $100,000 (AGI $400k − applicable $300k).
  # Correlated via §68(a)(1): 3% of excess equals $3,000.
  assertion (itemized_deductions_result.three_percent_reduction_68_a_1 = $3000)

  # itemized_deductions_reduction_applies: true → reduction amount under §68(a) is positive
  assertion (itemized_deductions_result.reduction_amount_68_a > $0)
```