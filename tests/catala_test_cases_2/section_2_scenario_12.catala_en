> Module Section_2_scenario_12
> Using Sections as IRC

```catala
#[test]
declaration scope Section_2_scenario_12:
  output hoh_result content IRC.IndividualTaxReturnSection2bHeadOfHouseholdOutput

scope Section_2_scenario_12:
  # Scenario: HOH disallowed because taxpayer is a nonresident alien at some time during the tax year
  # Tax year: 2025
  # Tested law refs:
  #  - §2(b)(3)(A): If at any time during the taxable year the taxpayer is a nonresident alien, HOH status is barred
  #  - §2(b)(1): General HOH test (maintenance and abode for qualifying person); here otherwise met
  definition hoh_result equals
    # Entities
    let t12 equals IRC.Individual { -- id: 1 -- is_counterfactual: false } in
    let c12 equals IRC.Individual { -- id: 2 -- is_counterfactual: false } in
    let h12 equals IRC.Household { -- id: 1 -- is_counterfactual: false } in

    # Events reflecting assumptions:
    # Child c12 lived in taxpayer's household for > half the year in 2025 (Jan 1–Aug 15)
    let res_c12 equals IRC.ResidencePeriodEvent {
      -- id: 1
      -- individual: c12
      -- household: h12
      -- start_date: Date.of_year_month_day of 2025, 1, 1
      -- end_date: Date.of_year_month_day of 2025, 8, 15
      -- is_member_of_household: true
      -- is_principal_place_of_abode: true
      -- is_counterfactual: false
    } in

    # Taxpayer furnished > half of household costs
    let hm_t12 equals IRC.HouseholdMaintenanceEvent {
      -- id: 1
      -- individual: t12
      -- household: h12
      -- start_date: Date.of_year_month_day of 2025, 1, 1
      -- end_date: Date.of_year_month_day of 2025, 12, 31
      -- cost_furnished_percentage: 0.66
      -- is_counterfactual: false
    } in

    # Parenthood (qualifying relationship)
    let par1 equals IRC.ParenthoodEvent {
      -- id: 1
      -- parent: t12
      -- child: c12
      -- start_date: Date.of_year_month_day of 2013, 1, 1
      -- parent_type: IRC.ParentType.Biological
      -- is_counterfactual: false
    } in

    # Taxpayer is a nonresident alien for part of the year (March 1–15, 2025)
    let nra1 equals IRC.NonresidentAlienStatusPeriodEvent {
      -- id: 1
      -- individual: t12
      -- start_date: Date.of_year_month_day of 2025, 3, 1
      -- end_date: Date.of_year_month_day of 2025, 3, 15
      -- residency_status: IRC.ResidencyStatus.NonresidentAlien
      -- is_counterfactual: false
    } in

    # Individual tax return: taxpayer files as Head of Household listing c12 as qualifying person
    let hoh_variant equals IRC.HeadOfHouseholdVariant {
      -- taxpayer: t12
      -- qualifying_person: c12
      -- itemization_election: false
      -- is_estate_or_trust: false
      -- is_common_trust_fund: false
      -- is_partnership: false
    } in
    let individual_tax_return equals IRC.IndividualTaxReturn {
      -- id: 1
      -- tax_year: 2025
      -- details: IRC.FilingStatusVariant.HeadOfHousehold content hoh_variant
    } in

    # Temporary dependent and §151 outputs (assumptions; not computing scopes)
    # Assume c12 is a qualifying child and a dependent
    let qc_c12 equals IRC.IndividualSection152QualifyingChildOutput {
      -- individual: c12
      -- taxpayer: t12
      -- is_qualifying_child: true
      -- bears_relationship_152_c_1_A: true
      -- has_same_principal_place_of_abode_152_c_1_B: true
      -- meets_age_requirements_152_c_1_C: true
      -- has_not_filed_joint_return_152_c_1_E: true
    } in
    let dep_status_c12 equals IRC.IndividualDependentStatus {
      -- individual: c12
      -- is_qualifying_child: true
      -- is_qualifying_relative: false
      -- is_excepted_under_152_b_2: false
      -- is_ineligible_under_152_b_1: false
    } in
    let taxpayer_dependents_result equals IRC.IndividualSection152DependentsOutput {
      -- taxpayer: t12
      -- dependents_initial: [ c12 ]
      -- dependents_after_152b1: [ c12 ]
      -- dependents_after_152b2: [ c12 ]
      -- qualifying_children: [ qc_c12 ]
      -- qualifying_relatives: []
      -- individual_dependent_statuses: [ dep_status_c12 ]
    } in

    let taxpayer_151_list equals IRC.IndividualSection151ExemptionsListOutput {
      -- individual: t12
      -- spouse_exemption_allowed_151_b: false
      -- individuals_entitled_to_exemptions_under_151: [ c12 ]
    } in
    let taxpayer_exemptions_list_result equals IRC.TaxpayerExemptionsList151Output {
      -- taxpayer_result: taxpayer_151_list
      -- spouse_result: Absent
      -- individuals_entitled_to_exemptions_under_151: [ c12 ]
      -- spouse_exemption_allowed_151_b: false
    } in

    # Call §2(b) Head of Household scope, passing contexts to reflect the legal facts
    (output of IRC.IndividualTaxReturnSection2bHeadOfHousehold with {
      -- individual_tax_return: individual_tax_return
      -- nonresident_alien_status_period_events: [ nra1 ]
      -- parenthood_events: [ par1 ]
      -- household_maintenance_events: [ hm_t12 ]
      -- residence_period_events: [ res_c12 ]
      -- marriage_events: []
      -- divorce_or_legal_separation_events: []
      -- family_relationship_events: []
      -- birth_events: []
      -- tax_return_events: []
      -- taxpayer_exemptions_list_result: taxpayer_exemptions_list_result
      -- taxpayer_dependents_result: taxpayer_dependents_result
      -- death_events: []
      -- is_surviving_spouse_2_a: false

      # Context booleans used directly in the output:
      # §2(b)(2) determinations (set consistent with being unmarried)
      -- is_legally_separated_2_b_2_A: false
      -- spouse_is_nonresident_alien_2_b_2_B: false
      -- spouse_died_during_year_2_b_2_C: false
      -- is_married_at_year_end_2_b_2: false

      # §2(b)(3)(A) limitation: taxpayer is a nonresident alien at some time during the year
      -- taxpayer_is_nonresident_alien_2_b_3_A: true

      # §2(b)(3)(B) limitation not applicable here
      -- head_of_household_disqualified_household_member_dependent_2_b_3_B: false

      # §2(b)(1)(A)(i) details about the qualifying child’s marriage/dependency conditions
      -- is_married_at_year_end_2_b_1_A_i_I: false
      -- is_not_dependent_by_152b2_2_b_1_A_i_II: false

      # §2(b)(1)(A) and maintenance/abode conditions (otherwise satisfied)
      -- qualifying_child_meets_2_b_1_A_i: true
      -- other_dependent_2_b_1_A_ii: false
      -- maintains_household_principal_place_of_abode_more_than_half_year_2_b_1_A: true
      -- maintains_household_for_father_or_mother_2_b_1_B: false

      # Overall HOH status under §2(b): false due to §2(b)(3)(A)
      -- is_head_of_household_2_b: false
    }).main_output

  # Assertions:
  # Tests §2(b)(3)(A): Limitation applies if taxpayer is a nonresident alien at any time during the year
  assertion (hoh_result.taxpayer_is_nonresident_alien_2_b_3_A = true)

  # Tests §2(b)(1) overall HOH status (taking into account §2(b)(3) limitations): should be false
  assertion (hoh_result.is_head_of_household_2_b = false)
```