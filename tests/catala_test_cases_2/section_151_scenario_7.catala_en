> Module Section_151_scenario_7
> Using Sections as IRC

```catala
#[test]
declaration scope Section_151_scenario_7:
  output computation content IRC.IRCSimplified

scope Section_151_scenario_7:
  # Scenario: 2017 Single filer who is a dependent of another taxpayer (parent lists child as dependent).
  # Tested law refs:
  # - §151(a): personal exemptions are deductions in computing taxable income
  # - §151(d)(1): exemption amount is $2,000 for 2017
  # - §151(d)(2): if another taxpayer can claim a §151 deduction for the individual, the individual's exemption amount is zero
  #
  # Assumption per scenario comments: Parent’s deduction under §151 is allowable (modeled via parent's TaxReturnEvent listing the child).

  definition computation equals
    # Individuals
    let i_child7 equals IRC.Individual { -- id: 1 -- is_counterfactual: false } in
    let i_parent7 equals IRC.Individual { -- id: 2 -- is_counterfactual: false } in

    # Parenthood relationship
    let parenthood7 equals IRC.ParenthoodEvent {
      -- id: 1
      -- parent: i_parent7
      -- child: i_child7
      -- start_date: Date.of_year_month_day of 2000, 5, 1
      -- parent_type: IRC.ParentType.Biological
      -- is_counterfactual: false
    } in

    # Child income in 2017 (not material to §151(d)(2) but included per inputs)
    let income_child7 equals IRC.IncomeEvent {
      -- id: 1
      -- individual: i_child7
      -- tax_year: 2017
      -- has_income: true
      -- earned_income: $3000
      -- is_counterfactual: false
    } in

    # Parent's 2017 return: lists the child as a dependent (and qualifying child)
    let tre_parent7 equals IRC.TaxReturnEvent {
      -- id: 1
      -- individual: i_parent7
      -- tax_year: 2017
      -- filed_joint_return: false
      -- is_only_for_refund_claim: false
      -- qualifying_children: [ i_child7 ]
      -- dependents: [ i_child7 ]
      -- is_counterfactual: false
    } in

    # Child's own 2017 return (Single)
    let tre_child7 equals IRC.TaxReturnEvent {
      -- id: 2
      -- individual: i_child7
      -- tax_year: 2017
      -- filed_joint_return: false
      -- is_only_for_refund_claim: false
      -- qualifying_children: []
      -- dependents: []
      -- is_counterfactual: false
    } in

    let single_details_7 equals IRC.SingleVariant {
      -- taxpayer: i_child7
      -- itemization_election: false
      -- is_estate_or_trust: false
      -- is_common_trust_fund: false
      -- is_partnership: false
    } in
    let individual_tax_return_7 equals IRC.IndividualTaxReturn {
      -- id: 1
      -- tax_year: 2017
      -- details: IRC.FilingStatusVariant.Single content single_details_7
    } in

    # Minimal dummy organization and FUTA return required by IRCSimplified
    let org1 equals IRC.Organization {
      -- id: 1
      -- organization_type: IRC.OrganizationType.Business
      -- is_counterfactual: false
    } in
    let futa_gen equals IRC.EmployerGeneralVariant { -- employer: org1 } in
    let futa_return equals IRC.EmployerUnemploymentExciseTaxReturn {
      -- id: 1
      -- tax_year: 2017
      -- details: IRC.EmployerVariant.GeneralEmployer content futa_gen
    } in

    # Call IRCSimplified (last resort comprehensive scope)
    output of IRC.IRCSimplified with {
      -- individual_tax_return: individual_tax_return_7
      -- individuals: [ i_child7; i_parent7 ]
      -- organizations: [ org1 ]
      -- birth_events: []
      -- blindness_status_events: []
      -- death_events: []
      -- nonresident_alien_status_period_events: []
      -- marriage_events: []
      -- divorce_or_legal_separation_events: []
      -- residence_period_events: []
      -- household_maintenance_events: []
      -- parenthood_events: [ parenthood7 ]
      -- family_relationship_events: []
      -- tax_return_events: [ tre_parent7; tre_child7 ]
      -- income_events: [ income_child7 ]
      -- employment_relationship_events: []
      -- wage_payment_events: []
      -- student_enrollment_events: []
      -- hospital_patient_events: []
      -- immigration_admission_events: []
      -- employment_termination_events: []
      -- employer_unemployment_excise_tax_return: futa_return
      -- itemized_deductions: $0
      -- adjusted_gross_income: $0
    }

  # Assertions - Only reference the computed scope output "computation"
  # 1) §151(d)(1): Exemption amount (base) for 2017 is $2,000
  assertion (computation.taxpayer_exemption_result.exemption_amount_base = $2000)

  # 2) §151(a): An exemption for the taxpayer is allowed in principle (taxpayer present in §151 entitled individuals list)
  assertion (
    computation.taxpayer_exemptions_list_result.individuals_entitled_to_exemptions_under_151
    contains computation.taxpayer_exemption_result.individual
  )

  # 3) §151(d)(2): Because another taxpayer (the parent) can claim a §151 deduction for the child in 2017,
  #    the child's exemption amount applicable to their year is zero (disallowance to $0).
  assertion (computation.taxpayer_exemption_result.exemption_amount_after_disallowance = $0)

  # 4) §151(a) deduction amount for the taxpayer: zero due to §151(d)(2)
  assertion (computation.taxpayer_exemption_result.personal_exemptions_deduction_151_a = $0)

  # 5) Total exemptions deduction (for this Single taxpayer with no spouse/dependents on own return) is $0
  assertion (computation.taxpayer_exemption_result.personal_exemptions_deduction_151_a = $0)
```