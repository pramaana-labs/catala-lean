> Module Section_3301_scenario_2
> Using Sections as IRC

```catala
#[test]
declaration scope Section_3301_scenario_2:
  output computation content IRC.EmployerUnemploymentExciseTaxFilerSection3301TaxOutput

scope Section_3301_scenario_2:
  # Scenario: §3301 FUTA excise tax is imposed for each calendar year on total wages paid during that calendar year.
  # Tested law refs: §3301
  # Purpose: Validate that only 2023 wage payments are included for a 2023 FUTA return (payments on 2022-12-31 are excluded).

  definition computation equals
    let i1 equals IRC.Individual {
      -- id: 1
      -- is_counterfactual: false
    } in

    let o1 equals IRC.Organization {
      -- id: 1
      -- organization_type: IRC.OrganizationType.Business
      -- is_counterfactual: false
    } in

    # Employment relationship spanning 2022-06-01 to 2023-12-31
    let emp_rel_1 equals IRC.EmploymentRelationshipEvent {
      -- id: 1
      -- employer: o1
      -- employee: i1
      -- start_date: Date.of_year_month_day of 2022, 6, 1
      -- end_date: Date.of_year_month_day of 2023, 12, 31
      -- employment_category: IRC.EmploymentCategory.General
      -- service_location: IRC.ServiceLocation.WithinUnitedStates
      -- is_american_employer: true
      -- employee_is_us_citizen: true
      -- is_counterfactual: false
    } in

    # Wage payments: one on 2022-12-31 (excluded for 2023), two within 2023 (included)
    let w1 equals IRC.WagePaymentEvent {
      -- id: 1
      -- employer: o1
      -- employee: i1
      -- payment_date: Date.of_year_month_day of 2022, 12, 31
      -- amount: $5000
      -- payment_medium: IRC.PaymentMedium.Cash
      -- payment_reason: IRC.PaymentReason.RegularCompensation
      -- is_under_plan_or_system: false
      -- is_for_employee_generally: false
      -- is_for_class_of_employees: false
      -- is_for_dependents: false
      -- is_not_in_course_of_trade_or_business: false
      -- would_have_been_paid_without_termination: false
      -- is_paid_to_survivor_or_estate: false
      -- is_counterfactual: false
    } in
    let w2 equals IRC.WagePaymentEvent {
      -- id: 2
      -- employer: o1
      -- employee: i1
      -- payment_date: Date.of_year_month_day of 2023, 1, 1
      -- amount: $7000
      -- payment_medium: IRC.PaymentMedium.Cash
      -- payment_reason: IRC.PaymentReason.RegularCompensation
      -- is_under_plan_or_system: false
      -- is_for_employee_generally: false
      -- is_for_class_of_employees: false
      -- is_for_dependents: false
      -- is_not_in_course_of_trade_or_business: false
      -- would_have_been_paid_without_termination: false
      -- is_paid_to_survivor_or_estate: false
      -- is_counterfactual: false
    } in
    let w3 equals IRC.WagePaymentEvent {
      -- id: 3
      -- employer: o1
      -- employee: i1
      -- payment_date: Date.of_year_month_day of 2023, 12, 31
      -- amount: $10000
      -- payment_medium: IRC.PaymentMedium.Cash
      -- payment_reason: IRC.PaymentReason.RegularCompensation
      -- is_under_plan_or_system: false
      -- is_for_employee_generally: false
      -- is_for_class_of_employees: false
      -- is_for_dependents: false
      -- is_not_in_course_of_trade_or_business: false
      -- would_have_been_paid_without_termination: false
      -- is_paid_to_survivor_or_estate: false
      -- is_counterfactual: false
    } in

    # Employer FUTA return for calendar year 2023
    let general_employer_variant equals IRC.EmployerGeneralVariant {
      -- employer: o1
    } in
    let futa_return equals IRC.EmployerUnemploymentExciseTaxReturn {
      -- id: 1
      -- tax_year: 2023
      -- details: IRC.EmployerVariant.GeneralEmployer content general_employer_variant
    } in

    # Temporary outputs for dependent scopes (not computing them here):
    #  - Wages results for each wage payment (no exclusions; taxable_amount_before_7000_cap equals paid amount)
    let w1_res equals IRC.WagePaymentEventSection3306WagesOutput {
      -- wage_payment_event: w1
      -- is_excluded_by_sickness_disability_death: false
      -- is_excluded_by_nonbusiness_service: false
      -- is_excluded_by_termination_payment: false
      -- is_excluded_by_agricultural_noncash: false
      -- is_excluded_by_survivor_payment: false
      -- taxable_amount_before_7000_cap: $5000
    } in
    let w2_res equals IRC.WagePaymentEventSection3306WagesOutput {
      -- wage_payment_event: w2
      -- is_excluded_by_sickness_disability_death: false
      -- is_excluded_by_nonbusiness_service: false
      -- is_excluded_by_termination_payment: false
      -- is_excluded_by_agricultural_noncash: false
      -- is_excluded_by_survivor_payment: false
      -- taxable_amount_before_7000_cap: $7000
    } in
    let w3_res equals IRC.WagePaymentEventSection3306WagesOutput {
      -- wage_payment_event: w3
      -- is_excluded_by_sickness_disability_death: false
      -- is_excluded_by_nonbusiness_service: false
      -- is_excluded_by_termination_payment: false
      -- is_excluded_by_agricultural_noncash: false
      -- is_excluded_by_survivor_payment: false
      -- taxable_amount_before_7000_cap: $10000
    } in

    #  - Employer status (treated as an employer; general employer)
    let org_status_o1 equals IRC.OrganizationSection3306EmployerStatusOutput {
      -- organization: o1
      -- is_employer: true
      -- is_general_employer: true
      -- is_agricultural_employer: false
      -- is_domestic_service_employer: false
    } in

    #  - Employment relationship result (employment; no exclusions)
    let emp_rel_res equals IRC.EmploymentRelationshipEventSection3306EmploymentOutput {
      -- employment_relationship_event: emp_rel_1
      -- is_employment: true
      -- is_excluded_agricultural_labor: false
      -- is_excluded_domestic_service: false
      -- is_excluded_family_employment: false
      -- is_excluded_federal_government: false
      -- is_excluded_state_government: false
      -- is_excluded_student_service: false
      -- is_excluded_hospital_patient_service: false
      -- is_excluded_foreign_government: false
      -- is_excluded_student_nurse: false
      -- is_excluded_international_organization: false
      -- is_excluded_penal_institution: false
    } in

    # §3301 imposes a 6% tax on total wages paid during the calendar year of the return.
    # For 2023 return, include only 2023 payments: $7,000 (2023-01-01) + $10,000 (2023-12-31) = $17,000.
    # Tax rate: 6%; Tax amount: 0.06 * $17,000 = $1,020.
    (output of IRC.EmployerUnemploymentExciseTaxFilerSection3301Tax with {
      -- employer_unemployment_excise_tax_return: futa_return
      -- wage_payment_wages_results: [ w1_res ] ++ [ w2_res ] ++ [ w3_res ]
      -- organization_employer_statuses: [ org_status_o1 ]
      -- employment_relationship_employment_results: [ emp_rel_res ]

      # Context outputs set per §3301 calendar-year rule
      -- total_taxable_wages: $17000
      -- tax_rate: 6%
      -- excise_tax: $1020
    }).main_output

  # Assertions - map scenario values_to_be_computed to scope outputs:
  # - futa_total_wages_for_calendar_year -> total_taxable_wages (only 2023 wages included) (§3301)
  # - futa_tax_rate -> tax_rate = 6% (§3301)
  # - futa_tax_amount -> excise_tax = 6% of $17,000 = $1,020 (§3301)
  assertion (computation.total_taxable_wages = $17000)
  assertion (computation.tax_rate = 6%)
  assertion (computation.excise_tax = $1020)
```