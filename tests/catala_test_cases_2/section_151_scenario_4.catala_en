> Module Section_151_scenario_4
> Using Sections as IRC

```catala
#[test]
declaration scope Section_151_scenario_4:
  output computation content IRC.IRCSimplified

scope Section_151_scenario_4:
  # Scenario: 2017 Married Filing Separately; spouse has gross income.
  # Tested law refs: §151(a), §151(b), §151(d)(1)
  # Notes:
  # - Tax year is 2017, so §151(d)(5) zeroing for 2018–2025 does not apply.
  # - Phaseout under §151(d)(3) not computed; pass adjusted_gross_income = $0 to avoid triggering it.

  definition computation equals
    # Entities
    let i_t4 equals IRC.Individual { -- id: 1 -- is_counterfactual: false } in
    let i_s4 equals IRC.Individual { -- id: 2 -- is_counterfactual: false } in

    let org1 equals IRC.Organization {
      -- id: 1
      -- organization_type: IRC.OrganizationType.Business
      -- is_counterfactual: false
    } in

    # Events
    let marriage_1 equals IRC.MarriageEvent {
      -- id: 1
      -- spouse1: i_t4
      -- spouse2: i_s4
      -- marriage_date: Date.of_year_month_day of 2015, 3, 10
      -- is_counterfactual: false
    } in

    let income_spouse_2017 equals IRC.IncomeEvent {
      -- id: 1
      -- individual: i_s4
      -- tax_year: 2017
      -- has_income: true
      -- earned_income: $3000
      -- is_counterfactual: false
    } in
    let income_taxpayer_2017 equals IRC.IncomeEvent {
      -- id: 2
      -- individual: i_t4
      -- tax_year: 2017
      -- has_income: true
      -- earned_income: $60000
      -- is_counterfactual: false
    } in

    let tr_event_t4_2017 equals IRC.TaxReturnEvent {
      -- id: 1
      -- individual: i_t4
      -- tax_year: 2017
      -- filed_joint_return: false
      -- is_only_for_refund_claim: false
      -- qualifying_children: []
      -- dependents: []
      -- is_counterfactual: false
    } in

    # Individual income tax return (Married Filing Separate)
    let mfs_details equals IRC.MarriedFilingSeparateVariant {
      -- taxpayer: i_t4
      -- spouse: i_s4
      -- itemization_election: false
      -- spouse_itemization_election: false
      -- is_estate_or_trust: false
      -- is_common_trust_fund: false
      -- is_partnership: false
    } in
    let individual_tax_return equals IRC.IndividualTaxReturn {
      -- id: 1
      -- tax_year: 2017
      -- details: IRC.FilingStatusVariant.MarriedFilingSeparate content mfs_details
    } in

    # Minimal FUTA excise tax return (dummy, unused in this scenario but required by IRCSimplified)
    let futa_return equals IRC.EmployerUnemploymentExciseTaxReturn {
      -- id: 1
      -- tax_year: 2017
      -- details: IRC.EmployerVariant.GeneralEmployer content IRC.EmployerGeneralVariant {
        -- employer: org1
      }
    } in

    # Call IRCSimplified with all inputs
    output of IRC.IRCSimplified with {
      -- individual_tax_return: individual_tax_return
      -- individuals: [ i_t4 ] ++ [ i_s4 ]
      -- organizations: [ org1 ]

      -- birth_events: []
      -- blindness_status_events: []
      -- death_events: []
      -- nonresident_alien_status_period_events: []
      -- marriage_events: [ marriage_1 ]
      -- divorce_or_legal_separation_events: []
      -- residence_period_events: []
      -- household_maintenance_events: []
      -- parenthood_events: []
      -- family_relationship_events: []
      -- tax_return_events: [ tr_event_t4_2017 ]
      -- income_events: [ income_spouse_2017 ] ++ [ income_taxpayer_2017 ]
      -- employment_relationship_events: []
      -- wage_payment_events: []
      -- student_enrollment_events: []
      -- hospital_patient_events: []
      -- immigration_admission_events: []
      -- employment_termination_events: []

      -- employer_unemployment_excise_tax_return: futa_return

      # Computation inputs: set to $0 to avoid §151(d)(3) phaseout impacts
      -- itemized_deductions: $0
      -- adjusted_gross_income: $0
    }

  # Assertions - Only reference outputs of the computed IRCSimplified scope

  # exemption_amount_value = 2000 under §151(d)(1) (2017 tax year)
  assertion (computation.taxpayer_exemption_result.exemption_amount_base = $2000)

  # taxpayer_exemption_allowed = true under §151(b) first clause (the taxpayer is entitled to his exemption)
  assertion (
    computation.taxpayer_exemptions_list_result.taxpayer_result.individuals_entitled_to_exemptions_under_151
      contains computation.taxpayer_exemptions_list_result.taxpayer_result.individual
  )

  # taxpayer_exemption_deduction_amount = 2000 under §151(a) and §151(b)
  assertion (computation.taxpayer_exemption_result.personal_exemptions_deduction_151_a = $2000)

  # spouse_exemption_allowed = false under §151(b) (spouse has gross income during the calendar year)
  assertion (computation.taxpayer_exemptions_list_result.spouse_exemption_allowed_151_b = false)

  # spouse_exemption_deduction_amount = 0
  # Since spouse exemption is disallowed and there are no dependents, total deduction equals taxpayer's exemption amount;
  # the difference (total - taxpayer amount) is $0, reflecting spouse deduction amount.
  assertion (
    computation.taxpayer_exemption_result.personal_exemptions_deduction_151_a
    - computation.taxpayer_exemption_result.exemption_amount_base
    = $0
  )

  # total_exemptions_deduction = 2000 (only taxpayer’s exemption allowed as a deduction under §151(a))
  assertion (computation.taxpayer_exemption_result.personal_exemptions_deduction_151_a = $2000)
```