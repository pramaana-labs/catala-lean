> Module Section_3306_scenario_13
> Using Sections as IRC

```catala
#[test]
declaration scope Section_3306_scenario_13:
  # Tuple of three employment determinations:
  # (1) spouse employed by spouse (expected excluded under §3306(c)(5)(A)),
  # (2) child under 21 employed by father (expected excluded under §3306(c)(5)(B)),
  # (3) child 21 or older employed by father (expected included as employment).
  output employment_results content
    (IRC.EmploymentRelationshipEventSection3306EmploymentOutput,
     IRC.EmploymentRelationshipEventSection3306EmploymentOutput,
     IRC.EmploymentRelationshipEventSection3306EmploymentOutput)

scope Section_3306_scenario_13:
  # Scenario: Family employment exclusions under §3306(c)(5).
  # Tested law refs:
  # - §3306(c)(5)(A): service performed by an individual in the employ of his son, daughter, or spouse → excluded from "employment".
  # - §3306(c)(5)(B): service performed by a child under the age of 21 in the employ of his father or mother → excluded from "employment".
  # Age determinations rely on year-end 2024 based on the birth events.
  definition employment_results equals
    let father equals IRC.Individual { -- id: 1 -- is_counterfactual: false } in
    let spouse1 equals IRC.Individual { -- id: 2 -- is_counterfactual: false } in
    let spouse2 equals IRC.Individual { -- id: 3 -- is_counterfactual: false } in
    let child_under21 equals IRC.Individual { -- id: 4 -- is_counterfactual: false } in
    let child_over21 equals IRC.Individual { -- id: 5 -- is_counterfactual: false } in

    let org13a equals IRC.Organization {
      -- id: 1
      -- organization_type: IRC.OrganizationType.Business
      -- is_counterfactual: false
    } in
    let org13b equals IRC.Organization {
      -- id: 2
      -- organization_type: IRC.OrganizationType.Business
      -- is_counterfactual: false
    } in
    let org13c equals IRC.Organization {
      -- id: 3
      -- organization_type: IRC.OrganizationType.Business
      -- is_counterfactual: false
    } in

    let birth_under21 equals IRC.BirthEvent {
      -- id: 1
      -- individual: child_under21
      -- birth_date: Date.of_year_month_day of 2005, 6, 1
      -- is_counterfactual: false
    } in
    let birth_over21 equals IRC.BirthEvent {
      -- id: 2
      -- individual: child_over21
      -- birth_date: Date.of_year_month_day of 2000, 1, 1
      -- is_counterfactual: false
    } in

    let marriage1 equals IRC.MarriageEvent {
      -- id: 1
      -- spouse1: spouse1
      -- spouse2: spouse2
      -- marriage_date: Date.of_year_month_day of 2020, 1, 1
      -- is_counterfactual: false
    } in

    let parenthood1 equals IRC.ParenthoodEvent {
      -- id: 1
      -- parent: father
      -- child: child_under21
      -- start_date: Date.of_year_month_day of 2005, 6, 1
      -- parent_type: IRC.ParentType.Biological
      -- is_counterfactual: false
    } in
    let parenthood2 equals IRC.ParenthoodEvent {
      -- id: 2
      -- parent: father
      -- child: child_over21
      -- start_date: Date.of_year_month_day of 2000, 1, 1
      -- parent_type: IRC.ParentType.Biological
      -- is_counterfactual: false
    } in

    # Employment relationships (calendar year 2024)
    # 1) Spouse employed (intended to test §3306(c)(5)(A))
    let employ_spouse equals IRC.EmploymentRelationshipEvent {
      -- id: 1
      -- employer: org13a
      -- employee: spouse2
      -- start_date: Date.of_year_month_day of 2024, 2, 1
      -- end_date: Date.of_year_month_day of 2024, 12, 31
      -- employment_category: IRC.EmploymentCategory.General
      -- service_location: IRC.ServiceLocation.WithinUnitedStates
      -- is_american_employer: false
      -- employee_is_us_citizen: true
      -- is_counterfactual: false
    } in
    # 2) Child under 21 employed by father (tests §3306(c)(5)(B))
    let employ_child_u21 equals IRC.EmploymentRelationshipEvent {
      -- id: 2
      -- employer: org13b
      -- employee: child_under21
      -- start_date: Date.of_year_month_day of 2024, 2, 1
      -- end_date: Date.of_year_month_day of 2024, 12, 31
      -- employment_category: IRC.EmploymentCategory.General
      -- service_location: IRC.ServiceLocation.WithinUnitedStates
      -- is_american_employer: false
      -- employee_is_us_citizen: true
      -- is_counterfactual: false
    } in
    # 3) Child aged 21 or older employed by father (should be included as employment)
    let employ_child_o21 equals IRC.EmploymentRelationshipEvent {
      -- id: 3
      -- employer: org13c
      -- employee: child_over21
      -- start_date: Date.of_year_month_day of 2024, 2, 1
      -- end_date: Date.of_year_month_day of 2024, 12, 31
      -- employment_category: IRC.EmploymentCategory.General
      -- service_location: IRC.ServiceLocation.WithinUnitedStates
      -- is_american_employer: false
      -- employee_is_us_citizen: true
      -- is_counterfactual: false
    } in

    let employment_relationship_events equals
      [ employ_spouse ] ++ [ employ_child_u21 ] ++ [ employ_child_o21 ]
    in
    let birth_events equals [ birth_under21 ] ++ [ birth_over21 ] in
    let parenthood_events equals [ parenthood1 ] ++ [ parenthood2 ] in
    let marriage_events equals [ marriage1 ] in
    let wage_payment_events equals [] in
    let student_enrollment_events equals [] in
    let hospital_patient_events equals [] in
    let immigration_admission_events equals [] in

    let spouse_employment_result equals
      (output of IRC.EmploymentRelationshipEventSection3306Employment with {
        -- employment_relationship_event: employ_spouse
        -- calendar_year: 2024
        -- wage_payment_events: wage_payment_events
        -- employment_relationship_events: employment_relationship_events
        -- student_enrollment_events: student_enrollment_events
        -- hospital_patient_events: hospital_patient_events
        -- immigration_admission_events: immigration_admission_events
        -- parenthood_events: parenthood_events
        -- birth_events: birth_events
        -- marriage_events: marriage_events
      }).main_output
    in

    let child_u21_employment_result equals
      (output of IRC.EmploymentRelationshipEventSection3306Employment with {
        -- employment_relationship_event: employ_child_u21
        -- calendar_year: 2024
        -- wage_payment_events: wage_payment_events
        -- employment_relationship_events: employment_relationship_events
        -- student_enrollment_events: student_enrollment_events
        -- hospital_patient_events: hospital_patient_events
        -- immigration_admission_events: immigration_admission_events
        -- parenthood_events: parenthood_events
        -- birth_events: birth_events
        -- marriage_events: marriage_events
      }).main_output
    in

    let child_o21_employment_result equals
      (output of IRC.EmploymentRelationshipEventSection3306Employment with {
        -- employment_relationship_event: employ_child_o21
        -- calendar_year: 2024
        -- wage_payment_events: wage_payment_events
        -- employment_relationship_events: employment_relationship_events
        -- student_enrollment_events: student_enrollment_events
        -- hospital_patient_events: hospital_patient_events
        -- immigration_admission_events: immigration_admission_events
        -- parenthood_events: parenthood_events
        -- birth_events: birth_events
        -- marriage_events: marriage_events
      }).main_output
    in

    (spouse_employment_result, child_u21_employment_result, child_o21_employment_result)

  # Assertions – Only reference the precomputed scope output "employment_results"

  # §3306(c)(5)(A): spouse employment is excluded from "employment"
  assertion (employment_results.1.is_excluded_family_employment = true)

  # §3306(c)(5)(B): child under 21 in employ of father/mother is excluded from "employment"
  # Based on birth date 2005-06-01, the child is 19 in tax year 2024.
  assertion (employment_results.2.is_excluded_family_employment = true)

  # Child aged 21 or older is not excluded under §3306(c)(5)(B); remains "employment".
  # Based on birth date 2000-01-01, the child is 24 in tax year 2024.
  assertion (employment_results.3.is_employment = true)
```