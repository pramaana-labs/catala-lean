> Module Section_2_scenario_2
> Using Sections as IRC

```catala
#[test]
declaration scope Section_2_scenario_2:
  output surviving_spouse_status content IRC.IndividualTaxReturnSection2aSurvivingSpouseOutput

scope Section_2_scenario_2:
  # Scenario: Surviving spouse fails due to remarriage before close of the taxable year
  # Tested law refs: §2(a)(1) and §2(a)(2)(A)
  # Assumptions: c2 is a dependent under §152 and the §151 deduction is allowable for c2

  definition surviving_spouse_status equals
    let t2 equals IRC.Individual { -- id: 1 -- is_counterfactual: false } in
    let s2 equals IRC.Individual { -- id: 2 -- is_counterfactual: false } in
    let c2 equals IRC.Individual { -- id: 3 -- is_counterfactual: false } in
    let ns2 equals IRC.Individual { -- id: 4 -- is_counterfactual: false } in

    let h2 equals IRC.Household { -- id: 1 -- is_counterfactual: false } in

    let death_s2 equals IRC.DeathEvent {
      -- id: 1
      -- decedent: s2
      -- death_date: Date.of_year_month_day of 2024, 3, 10
      -- is_counterfactual: false
    } in

    let marriage_t_s2 equals IRC.MarriageEvent {
      -- id: 1
      -- spouse1: t2
      -- spouse2: s2
      -- marriage_date: Date.of_year_month_day of 2016, 4, 1
      -- is_counterfactual: false
    } in
    let marriage_t_ns2 equals IRC.MarriageEvent {
      -- id: 2
      -- spouse1: t2
      -- spouse2: ns2
      -- marriage_date: Date.of_year_month_day of 2025, 7, 1
      -- is_counterfactual: false
    } in

    let res_c2_h2 equals IRC.ResidencePeriodEvent {
      -- id: 1
      -- individual: c2
      -- household: h2
      -- start_date: Date.of_year_month_day of 2025, 1, 1
      -- end_date: Date.of_year_month_day of 2025, 12, 31
      -- is_member_of_household: true
      -- is_principal_place_of_abode: true
      -- is_counterfactual: false
    } in

    let hm_t2_h2 equals IRC.HouseholdMaintenanceEvent {
      -- id: 1
      -- individual: t2
      -- household: h2
      -- start_date: Date.of_year_month_day of 2025, 1, 1
      -- end_date: Date.of_year_month_day of 2025, 12, 31
      -- cost_furnished_percentage: 0.65
      -- is_counterfactual: false
    } in

    let parent_t2_c2 equals IRC.ParenthoodEvent {
      -- id: 1
      -- parent: t2
      -- child: c2
      -- start_date: Date.of_year_month_day of 2012, 1, 1
      -- parent_type: IRC.ParentType.Biological
      -- is_counterfactual: false
    } in

    let residency_t2_2024 equals IRC.NonresidentAlienStatusPeriodEvent {
      -- id: 1
      -- individual: t2
      -- start_date: Date.of_year_month_day of 2024, 1, 1
      -- end_date: Date.of_year_month_day of 2024, 12, 31
      -- residency_status: IRC.ResidencyStatus.Resident
      -- is_counterfactual: false
    } in
    let residency_s2_2024 equals IRC.NonresidentAlienStatusPeriodEvent {
      -- id: 2
      -- individual: s2
      -- start_date: Date.of_year_month_day of 2024, 1, 1
      -- end_date: Date.of_year_month_day of 2024, 12, 31
      -- residency_status: IRC.ResidencyStatus.Resident
      -- is_counterfactual: false
    } in

    let ss_details equals IRC.SurvivingSpouseVariant {
      -- taxpayer: t2
      -- deceased_spouse: s2
      -- qualifying_dependent: c2
      -- itemization_election: false
      -- is_estate_or_trust: false
      -- is_common_trust_fund: false
      -- is_partnership: false
    } in
    let individual_tax_return equals IRC.IndividualTaxReturn {
      -- id: 1
      -- tax_year: 2025
      -- details: IRC.FilingStatusVariant.SurvivingSpouse content ss_details
    } in

    # Create temporary §151 exemptions list output asserting c2 is entitled to a §151 deduction
    let taxpayer_151_list equals IRC.IndividualSection151ExemptionsListOutput {
      -- individual: t2
      -- spouse_exemption_allowed_151_b: false
      -- individuals_entitled_to_exemptions_under_151: [ c2 ]
    } in
    let taxpayer_exemptions_list_result equals IRC.TaxpayerExemptionsList151Output {
      -- taxpayer_result: taxpayer_151_list
      -- spouse_result: Absent
      -- individuals_entitled_to_exemptions_under_151: [ c2 ]
      -- spouse_exemption_allowed_151_b: false
    } in

    # Call §2(a) surviving spouse scope; pass conditions via context booleans
    (output of IRC.IndividualTaxReturnSection2aSurvivingSpouse with {
      -- individual_tax_return: individual_tax_return
      -- death_events: [ death_s2 ]
      -- nonresident_alien_status_period_events: [ residency_t2_2024 ] ++ [ residency_s2_2024 ]
      -- parenthood_events: [ parent_t2_c2 ]
      -- household_maintenance_events: [ hm_t2_h2 ]
      -- residence_period_events: [ res_c2_h2 ]
      -- marriage_events: [ marriage_t_s2 ] ++ [ marriage_t_ns2 ]
      -- taxpayer_exemptions_list_result: taxpayer_exemptions_list_result

      # §2(a)(1)(A): spouse died during either of the two years immediately preceding the taxable year → true (death in 2024, tax year 2025)
      -- spouse_died_within_two_years_2_a_1_A: true
      # §2(a)(1)(B): maintains household as principal place of abode of a dependent with §151 deduction → true (c2; > 1/2 cost furnished; principal abode all year)
      -- maintains_household_qualifying_dependent_principal_abode_section151_2_a_1_B: true
      # §2(a)(2)(A): limitation—remarried at any time before close of taxable year → true (remarriage 2025-07-01)
      -- has_remarried_2_a_2_A: true
      # §2(a)(2)(B): joint return could have been made in death year → assume true
      -- joint_return_could_have_been_made_2_a_2_B: true
      # Final §2(a) status after applying limitations: not a surviving spouse due to remarriage
      -- is_surviving_spouse_2_a: false
    }).main_output

  # Assertions - ONLY reference scope output
  # Map to scenario 'is_surviving_spouse_under_2a1': assert §2(a)(1) conditions are satisfied
  assertion ((surviving_spouse_status.spouse_died_within_two_years_2_a_1_A and surviving_spouse_status.maintains_household_qualifying_dependent_principal_abode_section151_2_a_1_B) = true)
  # Map to scenario 'surviving_spouse_limitations_remarriage_under_2a2A_applies'
  assertion (surviving_spouse_status.has_remarried_2_a_2_A = true)
  # Also assert final status under §2(a) after applying limitations
  assertion (surviving_spouse_status.is_surviving_spouse_2_a = false)
```