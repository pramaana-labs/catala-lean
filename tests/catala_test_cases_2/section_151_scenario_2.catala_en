> Module Section_151_scenario_2
> Using Sections as IRC

```catala
#[test]
declaration scope Section_151_scenario_2:
  output computation content IRC.IRCSimplified

scope Section_151_scenario_2:
  # Scenario: 2019 Single filer who claims two dependents.
  # Tested law refs: §151(a), §151(c), §151(d)(5)
  # Assumption: The dependents listed on the tax return are dependents “as defined in §152.”
  #             Even if they are dependents, §151(d)(5) sets the exemption amount to zero for 2019.

  definition computation equals
    # Entities
    let i_t2 equals IRC.Individual { -- id: 1 -- is_counterfactual: false } in
    let i_d21 equals IRC.Individual { -- id: 2 -- is_counterfactual: false } in
    let i_d22 equals IRC.Individual { -- id: 3 -- is_counterfactual: false } in

    let dummy_org equals IRC.Organization {
      -- id: 1
      -- organization_type: IRC.OrganizationType.Business
      -- is_counterfactual: false
    } in

    # Individual income tax return (Single, TY 2019)
    let single_details equals IRC.SingleVariant {
      -- taxpayer: i_t2
      -- itemization_election: false
      -- is_estate_or_trust: false
      -- is_common_trust_fund: false
      -- is_partnership: false
    } in
    let individual_tax_return equals IRC.IndividualTaxReturn {
      -- id: 1
      -- tax_year: 2019
      -- details: IRC.FilingStatusVariant.Single content single_details
    } in

    # Tax return filing event recording the two dependents claimed
    let tre1 equals IRC.TaxReturnEvent {
      -- id: 1
      -- individual: i_t2
      -- tax_year: 2019
      -- filed_joint_return: false
      -- is_only_for_refund_claim: false
      -- qualifying_children: []
      -- dependents: [ i_d21 ] ++ [ i_d22 ]
      -- is_counterfactual: false
    } in

    # Minimal FUTA return (required by IRCSimplified inputs; not material to §151)
    let futa_return equals IRC.EmployerUnemploymentExciseTaxReturn {
      -- id: 1
      -- tax_year: 2019
      -- details: IRC.EmployerVariant.GeneralEmployer content IRC.EmployerGeneralVariant { -- employer: dummy_org }
    } in

    # Call the simplified IRC scope with all inputs; amounts defaulted where not provided
    output of IRC.IRCSimplified with {
      -- individual_tax_return: individual_tax_return
      -- individuals: [ i_t2 ] ++ [ i_d21 ] ++ [ i_d22 ]
      -- organizations: [ dummy_org ]

      -- birth_events: []
      -- blindness_status_events: []
      -- death_events: []
      -- nonresident_alien_status_period_events: []
      -- marriage_events: []
      -- divorce_or_legal_separation_events: []
      -- residence_period_events: []
      -- household_maintenance_events: []
      -- parenthood_events: []
      -- family_relationship_events: []
      -- tax_return_events: [ tre1 ]
      -- income_events: []
      -- employment_relationship_events: []
      -- wage_payment_events: []
      -- student_enrollment_events: []
      -- hospital_patient_events: []
      -- immigration_admission_events: []
      -- employment_termination_events: []

      -- employer_unemployment_excise_tax_return: futa_return

      # §63/§68 contexts (not material to §151 in this specific test)
      -- itemized_deductions: $0
      -- adjusted_gross_income: $0
    }

  # Assertions - ONLY reference the computed 'computation' output

  # exemption_amount_value = 0
  # Tests §151(d)(5): for taxable years beginning after 2017 and before 2026,
  # the exemption amount is zero.
  assertion (
    computation.taxpayer_exemption_result.exemption_amount_after_phaseout = $0
  )

  # taxpayer_exemption_allowed = true
  # Tests §151(a) (allowance of deductions) and consistency with §151(b):
  # taxpayer is entitled to an exemption (though the amount is zero under §151(d)(5)).
  assertion (
    let taxpayer equals IRC.get_taxpayer of computation.taxable_income_result.individual_tax_return in
    computation.taxpayer_exemptions_list_result.individuals_entitled_to_exemptions_under_151 contains taxpayer
  )

  # taxpayer_exemption_deduction_amount = 0
  # By §151(d)(5) for TY 2019, the taxpayer’s exemption amount (and thus deduction) is $0.
  assertion (
    computation.taxpayer_exemption_result.exemption_amount_after_phaseout = $0
  )

  # dependents_count_for_taxpayer = 2
  # Tests §151(c): two dependents were claimed; ensure two individuals (excluding taxpayer)
  # are in the list of individuals entitled to exemptions under §151.
  assertion (
    let taxpayer equals IRC.get_taxpayer of computation.taxable_income_result.individual_tax_return in
    let entitled equals computation.taxpayer_exemptions_list_result.individuals_entitled_to_exemptions_under_151 in
    number of (list of ind among entitled such that ind != taxpayer) = 2
  )

  # dependents_exemptions_deduction_amount = 0
  # With §151(d)(5) setting exemption amount to zero in 2019, dependents’ portion of
  # the personal exemptions deduction is also $0.
  assertion (
    computation.taxpayer_exemption_result.personal_exemptions_deduction_151_a
    - computation.taxpayer_exemption_result.exemption_amount_after_phaseout
    = $0
  )

  # total_exemptions_deduction = 0
  # Tests §151(a) together with §151(d)(5): the deduction for personal exemptions
  # (taxpayer plus dependents under §151(c)) is zero for TY 2019.
  assertion (
    computation.taxpayer_exemption_result.personal_exemptions_deduction_151_a = $0
  )
```