> Module Section_151_scenario_6
> Using Sections as IRC

```catala
#[test]
declaration scope Section_151_scenario_6:
  output computation content IRC.IRCSimplified

scope Section_151_scenario_6:
  # Scenario: 2017 Joint return filed by taxpayer and spouse.
  # Focus: §151(b) additional spouse exemption is NOT allowed when a joint return is made.
  # Tested law refs: §151(a), §151(b), §151(d)(1)

  definition computation equals
    # Entities
    let t6 equals IRC.Individual { -- id: 1 -- is_counterfactual: false } in
    let s6 equals IRC.Individual { -- id: 2 -- is_counterfactual: false } in

    # Minimal organization needed for IRCSimplified FUTA inputs
    let org1 equals IRC.Organization {
      -- id: 1
      -- organization_type: IRC.OrganizationType.Business
      -- is_counterfactual: false
    } in

    # Events
    let marriage1 equals IRC.MarriageEvent {
      -- id: 1
      -- spouse1: t6
      -- spouse2: s6
      -- marriage_date: Date.of_year_month_day of 2016, 11, 20
      -- is_counterfactual: false
    } in

    let inc_t6_2017 equals IRC.IncomeEvent {
      -- id: 1
      -- individual: t6
      -- tax_year: 2017
      -- has_income: true
      -- earned_income: $55000
      -- is_counterfactual: false
    } in
    let inc_s6_2017 equals IRC.IncomeEvent {
      -- id: 2
      -- individual: s6
      -- tax_year: 2017
      -- has_income: true
      -- earned_income: $15000
      -- is_counterfactual: false
    } in

    let tre_t6_2017 equals IRC.TaxReturnEvent {
      -- id: 1
      -- individual: t6
      -- tax_year: 2017
      -- filed_joint_return: true
      -- is_only_for_refund_claim: false
      -- qualifying_children: []
      -- dependents: []
      -- is_counterfactual: false
    } in

    # Individual income tax return for 2017 - Joint Return
    let joint_details equals IRC.JointReturnVariant {
      -- taxpayer: t6
      -- spouse: s6
      -- itemization_election: false
      -- is_estate_or_trust: false
      -- is_common_trust_fund: false
      -- is_partnership: false
    } in
    let individual_tax_return equals IRC.IndividualTaxReturn {
      -- id: 1
      -- tax_year: 2017
      -- details: IRC.FilingStatusVariant.JointReturn content joint_details
    } in

    # Minimal FUTA tax return required by IRCSimplified
    let futa_details equals IRC.EmployerGeneralVariant { -- employer: org1 } in
    let futa_return equals IRC.EmployerUnemploymentExciseTaxReturn {
      -- id: 1
      -- tax_year: 2017
      -- details: IRC.EmployerVariant.GeneralEmployer content futa_details
    } in

    # Call IRCSimplified once, providing all inputs (empty lists where not needed)
    output of IRC.IRCSimplified with {
      -- individual_tax_return: individual_tax_return
      -- individuals: [ t6 ] ++ [ s6 ]
      -- organizations: [ org1 ]
      -- birth_events: []
      -- blindness_status_events: []
      -- death_events: []
      -- nonresident_alien_status_period_events: []
      -- marriage_events: [ marriage1 ]
      -- divorce_or_legal_separation_events: []
      -- residence_period_events: []
      -- household_maintenance_events: []
      -- parenthood_events: []
      -- family_relationship_events: []
      -- tax_return_events: [ tre_t6_2017 ]
      -- income_events: [ inc_t6_2017 ] ++ [ inc_s6_2017 ]
      -- employment_relationship_events: []
      -- wage_payment_events: []
      -- student_enrollment_events: []
      -- hospital_patient_events: []
      -- immigration_admission_events: []
      -- employment_termination_events: []
      -- employer_unemployment_excise_tax_return: futa_return
      -- itemized_deductions: $0
      -- adjusted_gross_income: $0
    }

  # Assertions - ONLY referencing the computed scope output "computation"
  # Correlations to law text:
  # - §151(d)(1): Exemption amount is $2,000 for 2017.
  # - §151(b): Taxpayer exemption allowed; spouse additional exemption only if NO joint return.
  # - §151(a): Exemptions allowed as deductions; here total equals taxpayer's exemption since spouse additional disallowed on joint return.

  # exemption_amount_value = $2000 (tests §151(d)(1))
  assertion (computation.taxpayer_exemption_result.exemption_amount_base = $2000)

  # taxpayer_exemption_allowed = true without recreating entities
  assertion (
    computation.taxpayer_exemptions_list_result.taxpayer_result.individuals_entitled_to_exemptions_under_151
      contains computation.taxpayer_exemption_result.individual
  )

  # taxpayer_exemption_deduction_amount = $2000 (tests §151(a))
  assertion (computation.taxpayer_exemption_result.personal_exemptions_deduction_151_a = $2000)

  # spouse_exemption_allowed = false (tests §151(b) joint return disallowance)
  assertion (computation.taxpayer_exemptions_list_result.spouse_exemption_allowed_151_b = false)

  # spouse_exemption_deduction_amount = $0 (consequence of §151(b) joint return disallowance)
  assertion (
    (if computation.taxpayer_exemptions_list_result.spouse_exemption_allowed_151_b
     then computation.taxpayer_exemption_result.exemption_amount_base
     else $0) = $0
  )

  # total_exemptions_deduction = $2000 (only taxpayer exemption applies on joint return per scenario focus)
  assertion (computation.taxpayer_exemption_result.personal_exemptions_deduction_151_a = $2000)
```