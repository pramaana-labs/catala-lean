> Module Section_2_scenario_4
> Using Sections as IRC

```catala
#[test]
declaration scope Section_2_scenario_4:
  output surviving_spouse_status content IRC.IndividualTaxReturnSection2aSurvivingSpouseOutput

scope Section_2_scenario_4:
  # Scenario: Surviving spouse fails because taxpayer furnishes only 49% of household cost
  # Tested law refs: §2(a)(1) and its last sentence (must furnish over half the cost to be considered as maintaining a household)
  # Assumption per comments: c4 is a dependent under §152 and §151 (we pass this via taxpayer_exemptions_list_result)

  definition surviving_spouse_status equals
    let t4 equals IRC.Individual { -- id: 1 -- is_counterfactual: false } in
    let s4 equals IRC.Individual { -- id: 2 -- is_counterfactual: false } in
    let c4 equals IRC.Individual { -- id: 3 -- is_counterfactual: false } in

    let h4 equals IRC.Household { -- id: 1 -- is_counterfactual: false } in

    let marriage1 equals IRC.MarriageEvent {
      -- id: 1
      -- spouse1: t4
      -- spouse2: s4
      -- marriage_date: Date.of_year_month_day of 2018, 7, 20
      -- is_counterfactual: false
    } in

    let death_s4 equals IRC.DeathEvent {
      -- id: 1
      -- decedent: s4
      -- death_date: Date.of_year_month_day of 2024, 2, 18
      -- is_counterfactual: false
    } in

    let parent_t4_c4 equals IRC.ParenthoodEvent {
      -- id: 1
      -- parent: t4
      -- child: c4
      -- start_date: Date.of_year_month_day of 2013, 3, 1
      -- parent_type: IRC.ParentType.Biological
      -- is_counterfactual: false
    } in

    let res_c4_2025 equals IRC.ResidencePeriodEvent {
      -- id: 1
      -- individual: c4
      -- household: h4
      -- start_date: Date.of_year_month_day of 2025, 1, 1
      -- end_date: Date.of_year_month_day of 2025, 12, 31
      -- is_member_of_household: true
      -- is_principal_place_of_abode: true
      -- is_counterfactual: false
    } in

    let maint_t4_h4_2025 equals IRC.HouseholdMaintenanceEvent {
      -- id: 1
      -- individual: t4
      -- household: h4
      -- start_date: Date.of_year_month_day of 2025, 1, 1
      -- end_date: Date.of_year_month_day of 2025, 12, 31
      -- cost_furnished_percentage: 0.49
      -- is_counterfactual: false
    } in

    let rn_t4_2024 equals IRC.NonresidentAlienStatusPeriodEvent {
      -- id: 1
      -- individual: t4
      -- start_date: Date.of_year_month_day of 2024, 1, 1
      -- end_date: Date.of_year_month_day of 2024, 12, 31
      -- residency_status: IRC.ResidencyStatus.Resident
      -- is_counterfactual: false
    } in
    let rn_s4_2024 equals IRC.NonresidentAlienStatusPeriodEvent {
      -- id: 2
      -- individual: s4
      -- start_date: Date.of_year_month_day of 2024, 1, 1
      -- end_date: Date.of_year_month_day of 2024, 2, 18
      -- residency_status: IRC.ResidencyStatus.Resident
      -- is_counterfactual: false
    } in

    # Individual tax return: Surviving Spouse status for 2025 with qualifying dependent c4
    let surv_variant equals IRC.SurvivingSpouseVariant {
      -- taxpayer: t4
      -- deceased_spouse: s4
      -- qualifying_dependent: c4
      -- itemization_election: false
      -- is_estate_or_trust: false
      -- is_common_trust_fund: false
      -- is_partnership: false
    } in
    let itr_details equals IRC.FilingStatusVariant.SurvivingSpouse content surv_variant in
    let individual_tax_return equals IRC.IndividualTaxReturn {
      -- id: 1
      -- tax_year: 2025
      -- details: itr_details
    } in

    # Assumption mapping: c4 is a dependent for whom §151 deduction applies
    let taxpayer_151_list equals IRC.IndividualSection151ExemptionsListOutput {
      -- individual: t4
      -- spouse_exemption_allowed_151_b: false
      -- individuals_entitled_to_exemptions_under_151: [ c4 ]
    } in
    let taxpayer_exemptions_list_result equals IRC.TaxpayerExemptionsList151Output {
      -- taxpayer_result: taxpayer_151_list
      -- spouse_result: Absent
      -- individuals_entitled_to_exemptions_under_151: [ c4 ]
      -- spouse_exemption_allowed_151_b: false
    } in

    # Call §2(a) surviving spouse scope with explicit context values
    (output of IRC.IndividualTaxReturnSection2aSurvivingSpouse with {
      -- individual_tax_return: individual_tax_return
      -- death_events: [ death_s4 ]
      -- nonresident_alien_status_period_events: [ rn_t4_2024 ] ++ [ rn_s4_2024 ]
      -- parenthood_events: [ parent_t4_c4 ]
      -- household_maintenance_events: [ maint_t4_h4_2025 ]
      -- residence_period_events: [ res_c4_2025 ]
      -- marriage_events: [ marriage1 ]
      -- taxpayer_exemptions_list_result: taxpayer_exemptions_list_result

      # §2(a)(1)(A): spouse died within two years preceding the tax year (death in 2024 for tax year 2025)
      -- spouse_died_within_two_years_2_a_1_A: true
      # §2(a)(1)(B) last sentence: maintaining a household requires furnishing over half of cost; 49% fails
      -- maintains_household_qualifying_dependent_principal_abode_section151_2_a_1_B: false
      # §2(a)(2)(A): not remarried before close of the taxable year
      -- has_remarried_2_a_2_A: false
      # §2(a)(2)(B): joint return could have been made in death year (no NRA spouse during that year)
      -- joint_return_could_have_been_made_2_a_2_B: true
      # Final status under §2(a)
      -- is_surviving_spouse_2_a: false
    }).main_output

  # Assertions:
  # Maps to "maintains_household_over_half_cost_for_tax_year" per §2(a)(1) last sentence
  assertion (surviving_spouse_status.maintains_household_qualifying_dependent_principal_abode_section151_2_a_1_B = false)

  # Maps to "is_surviving_spouse_under_2a1": failure of maintenance requirement causes overall failure under §2(a)(1)
  assertion (surviving_spouse_status.is_surviving_spouse_2_a = false)
```